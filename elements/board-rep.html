<link rel="import" href="../bower_components/polymer/polymer.html">

<script>
	BoardRep = Polymer({
		is: "board-rep",
    properties: {
      cards: Array
    },
    factoryImpl: function(cards) {
      var size = 3;

      if (!cards) {
        cards = [];
        for (i = 0; i < size; i++) {
          cards[i] = Array(size);
        }
      }

      this.cards = cards;
    },
    objectify: function () {
      return {
        cards: this.cards.map(function (row) {
          return row.map(function (card) {
            if (card) {
              return card.objectify();
            }
          });
        })
      };
    },
    getCardCounts: function () {
       return this.cards.map(function (row) {
        return row.filter(function (card) {
          return card;
        }).map(function (card) {
          return {
            color: card.color,
            sum: 1
          };
        });
      }).reduce(function (a,b) {
        return a.concat(b);
      }).reduce(function (previous,current) {
        previous[current.color] = (previous[current.color] || 0) + current.sum
        return previous;
      },{});
    },
    getAvailableSpaces: function () {
      return this.cards.map(function (row, rowIndex) {
        return row.map(function (card, colIndex) {
          if (!card) {
            return {
              row: rowIndex,
              column: colIndex
            };
          }
        }).filter(function (space) {
          return space;
        });
      }).reduce(function (a,b) {
        return a.concat(b);
      },[]);
    },
    getAdjacentCards: function (rowPosition,columnPosition) {
      var positions = {
        "r-1c0": "top",
        "r0c-1": "left",
        "r0c1": "right",
        "r1c0": "bottom"
      };

      return this.cards.map(function (row, rowIndex) {
        return row.map(function (card, cardIndex) {
          var positionIdentifier = "r" + (rowIndex - rowPosition) + "c" + (cardIndex - columnPosition);

          if (card && positionIdentifier in positions) {
            return {
              position: positions[positionIdentifier], 
              card: card
            };
          }
        }).filter(function (element) {
          return element;
        });
      }).reduce(function (a,b) {
        return a.concat(b);
      }).reduce(function (previous,current) {
        previous[current.position] = current.card;
        return previous;
      },{});
    }
	});
</script>